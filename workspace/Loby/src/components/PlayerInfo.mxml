<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:s="library://ns.adobe.com/flex/spark" 
	xmlns:fx="http://ns.adobe.com/mxml/2009"
	currentStateChange="playerinfo_currentStateChangeHandler(event)" 
	currentState="StateStart" xmlns:mx="library://ns.adobe.com/flex/halo">
	<fx:Script>
		<![CDATA[
			import lobystate.StateGetItemeffect;
			import lobystate.StateGetPlayerInfo;
			import item.miscDefines;
			
			import mx.events.StateChangeEvent;
			
			import poker.LevelDefine;
			protected function Button_click():void
			{
				currentState='StateStart';
				LobyManager.Instance.windowMutex = false;
			}

			protected function playerinfo_currentStateChangeHandler(event:StateChangeEvent):void
			{
				if(event.currentTarget.currentState == "StateStart")
				{
					visible = false;
				}
				else if(event.currentTarget.currentState == "StateMain")
				{
					gamenameText.text = "";
					scoreText.text = "";
					levelText.text = "";
					// 对成绩赋值
					for each(var obj:Object in StateGetPlayerInfo.Instance.lastSuccData.player.score)
					{
						gamenameText.text += obj.name;
						gamenameText.text += "\n";
						scoreText.text += obj.score;
						scoreText.text += "分\n";
						levelText.text += LevelDefine.getLevelName(int(obj.score));
						levelText.text += "\n";
					}
					//
					playername.text = StateGetPlayerInfo.Instance.lastSuccData.player.name;
					avatar.source = StateGetPlayerInfo.Instance.playerMiddleAvatar;
					gold.text = StateGetPlayerInfo.Instance.lastSuccData.player.money+" 金币";
					
					// 对玩家的道具的持续时间部分进行描画,x=38,y=250
					var idx:int = 0;
					for each(var it:Object in StateGetItemeffect.Instance.lastSuccData.effects)
					{
						//
						var img:Image = new Image();
						img.source = LobyNetManager.URL_lobysonAddress + "/resources/image/item/" + it.iid + ".png";
						img.x = 38 + idx*20;
						img.y = 250;
						img.height = 20;
						img.width = 20;
						var date:Date = new Date();
						var time:Number = Number(it.starttime)*1000+Number(it.effecttime)*1000;
						date.setTime(time);
						img.toolTip = miscDefines.getItemName(it.iid)+"\n"+ "有效期至:"+date.getFullYear()+"/"+(date.getMonth()+1)+"/"+date.getDate();
						this.addElement(img);
						idx++;
					}
				}
			}

		]]>

	</fx:Script>
	<s:transitions>
		<s:Transition fromState="StateMain" toState="StateStart" autoReverse="true">
			<s:Parallel>
				<s:Parallel target="{bitmapimage1}">
					<s:Fade duration="150"/>
				</s:Parallel>
				<s:Parallel target="{button1}">
					<s:Fade duration="50"/>
				</s:Parallel>
				<s:Parallel target="{gamenameText}">
					<s:Fade duration="100"/>
				</s:Parallel>
				<s:Parallel target="{scoreText}">
					<s:Fade duration="100"/>
				</s:Parallel>
				<s:Parallel target="{levelText}">
					<s:Fade duration="100"/>
				</s:Parallel>
				<s:Parallel target="{playername}">
					<s:Fade duration="100"/>
				</s:Parallel>
			</s:Parallel>
		</s:Transition>
		<s:Transition fromState="StateStart" toState="StateMain" autoReverse="true">
			<s:Parallel>
				<s:Parallel target="{bitmapimage1}">
					<s:Fade duration="100"/>
				</s:Parallel>
				<s:Parallel target="{gamenameText}">
					<s:Fade duration="50"/>
				</s:Parallel>
				<s:Parallel target="{scoreText}">
					<s:Fade duration="50"/>
				</s:Parallel>
				<s:Parallel target="{levelText}">
					<s:Fade duration="50"/>
				</s:Parallel>
				<s:Parallel target="{playername}">
					<s:Fade duration="50"/>
				</s:Parallel>
				<s:Parallel target="{button1}">
					<s:Fade duration="50"/>
				</s:Parallel>
			</s:Parallel>
		</s:Transition>
	</s:transitions>
	<s:states>
		<s:State name="StateMain"/>
		<s:State name="StateStart"/>
	</s:states>
	<mx:Image source="@Embed('/assets/Bg_shop.swf')" includeIn="StateMain" id="bitmapimage1"/>
	<s:RichText y="200" color="#ffffff" x="113" fontSize="14" fontFamily="宋体" width="77" height="44" id="scoreText" includeIn="StateMain"/>
	<s:BitmapImage source="@Embed('/assets/playerinfo_title.png')" resizeMode="scale" includeIn="StateMain" x="11" y="3"/>
	<s:BitmapImage source="@Embed('/assets/playerinfo_text.png')" resizeMode="scale" includeIn="StateMain" x="31" y="171"/>
	<s:BitmapImage source="@Embed('/assets/playerinfo_Gold.png')" resizeMode="scale" includeIn="StateMain" x="28.15" y="140.1"/>
	<s:BitmapImage source="@Embed('/assets/playerinfo_nickname.png')" resizeMode="scale" includeIn="StateMain" x="135" y="47"/>
	<s:Button skinClass="components.OptionWindow_CloseButton" label="Button" x="317" y="6" id="button1" includeIn="StateMain" click="Button_click()"/>
	<s:RichText y="200" color="#ffffff" x="38" fontSize="14" fontFamily="宋体" width="69" height="44" id="gamenameText" x.StateMain="43" y.StateMain="200" width.StateMain="65"/>
	<s:RichText y="200" color="#ffffff" x="211" fontSize="14" fontFamily="宋体" width="109" height="44" id="levelText" includeIn="StateMain"/>
	<s:RichText y="89" color="0x4769C4" x="149" fontSize="14" fontFamily="宋体" width="163" height="42" includeIn="StateMain" id="playername"/>
	<mx:Image includeIn="StateMain" scaleContent="true" x="29" y="52" width="83" height="79" id="avatar" source=""/>
	<mx:Label includeIn="StateMain" x="63" y="145" text="" width="93" fontFamily="宋体" fontSize="16" id="gold"/>
</s:Group>