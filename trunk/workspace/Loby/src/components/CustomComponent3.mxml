<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:s="library://ns.adobe.com/flex/spark" 
	xmlns:fx="http://ns.adobe.com/mxml/2009" 
	xmlns:th="http://ns.adobe.com/thermo/2009"
	xmlns:mx="library://ns.adobe.com/flex/halo"
	xmlns:components="components.*" 
	currentState="State2" 
	creationComplete="group1_creationCompleteHandler(event)" xmlns:message="message.*">
	<fx:Style>
		.datagridheader{
			color: #000000;
			fontsize: 12;
		}
	</fx:Style>
	<s:BitmapImage source="@Embed('/assets/bg_5.png')" resizeMode="scale" includeIn="State3" id="bitmapimage1"/>
	<s:Button includeIn="State3" x="13" skinClass="components.ButtonMsgEmotion" y="414" click="btnEmotion_clickHandler(event)"/>
	<s:Button includeIn="State3" x="64" y="414" skinClass="components.ButtonMsgToAll" click="shoutbtn_clickHandler(event)"/>
	<s:Button includeIn="State3" x="254" y="436" skinClass="components.Button_GameTalk_say" click="lobbySendMsg(event)" toolTip="发送聊天对话"/>
	<mx:DataGrid id="lobbyplayerlist" includeIn="State3" x="13" y="27" width="257" editable="false" height="173" baseColor="#f6edae" alternatingItemColors="[#114734, #083025]" contentBackgroundAlpha="0" backgroundAlpha="0"
		dataProvider="{StateGetRoomPlayerlist.Instance.roomlist}" dragEnabled="false"
		headerStyleName="datagridheader" dragMoveEnabled="false" draggableColumns="false">
		<mx:columns>
			<mx:DataGridColumn headerText="昵称" dataField="name" color="#FFFFFF"/>
			<mx:DataGridColumn headerText="金币数" dataField="money" color="#FFFFFF"/>
			<mx:DataGridColumn headerText="级别" dataField="level" color="#FFFFFF"/>
			<mx:DataGridColumn headerText="积分" dataField="score" color="#FFFFFF"/>
		</mx:columns>
	</mx:DataGrid>
	<!--<s:Group id="textshow" includeIn="State3" x="13" y="205" width="241" height="206">-->
	<s:TextArea x="13" y="205" id="lobbychatbox" includeIn="State3" width="257" height="206" color="#FFFFFF" baseColor="#f6edae" editable="false" creationComplete="lobbychatbox_creationCompleteHandler(event)" contentBackgroundAlpha="0"/>
	<!--</s:Group>-->	
	<!--<mx:VScrollBar height="206" x="257" y="199" id="lobbyTextScroll" scroll="scrollListener(event)" includeIn="State3" visible="false"/>-->
	<mx:ColorPicker includeIn="State3" x="118" y="413" selectedColor="#FFFFFF" change="colorpicker1_changeHandler(event)"/>
	<mx:Label includeIn="State3" x="33" y="414" text="表情" color="#FFFFFF"/>
	<mx:Label includeIn="State3" x="86" y="414" text="喊话" color="#FFFFFF"/>
	<mx:Label x="144" y="414" text="颜色" color="#FFFFFF" includeIn="State3"/>
	<mx:Label x="219" y="414" text="文字大小" color="#FFFFFF" includeIn="State3" width="54" textAlign="left"/>
	<s:NumericStepper includeIn="State3" x="173" y="414" width="46" height="20" minimum="12" maximum="30" 
		color="#000000" id="fontsizeStepper" change="fontsizeStepper_changeHandler(event)"/>
	<message:chatEmotion id="emotion" includeIn="State3" x="14" y="293" visible="false">
	</message:chatEmotion>
	<!--<s:Button includeIn="State3" x="263" y="413" label="et" click="button1_clickHandler(event)" width="15" height="21"/>-->
	<s:transitions>
		<s:Transition fromState="State2" toState="State3" autoReverse="true">
			<s:Parallel>
				<s:Parallel target="{bitmapimage1}">
					<s:Fade duration="0"/>
				</s:Parallel>
			</s:Parallel>
		</s:Transition>
		<s:Transition fromState="State3" toState="State2" autoReverse="true">
			<s:Parallel>
				<s:Parallel target="{bitmapimage1}">
					<s:Fade duration="0"/>
				</s:Parallel>
			</s:Parallel>
		</s:Transition>
	</s:transitions>
	<s:states>
		<s:State name="State2" th:color="0x0081cc" enterState="state2_enterStateHandler(event)"/>
		<s:State name="State3" enterState="state3_enterStateHandler(event)"/>
	</s:states>
	<fx:Script>
		<![CDATA[
			import flashx.textLayout.elements.InlineGraphicElement;
			import flashx.textLayout.elements.ParagraphElement;
			import flashx.textLayout.elements.SpanElement;
			import flashx.textLayout.elements.TextFlow;
			
			import item.playerItemsRequester;
			import lobystate.StateGetRoomPlayerlist;
			
			import message.ContentViewer;
			import message.Messenger;
			import message.ResEmotion;
			import message.chatEmotion;
			import message.inputEditManager;
			
			import mx.core.FlexGlobals;
			import mx.core.UIComponent;
			import mx.events.ColorPickerEvent;
			import mx.events.FlexEvent;
			import mx.controls.Alert;
			private var ui1:UIComponent = new UIComponent();
			public var inputboxLobby:ContentViewer = new ContentViewer();
			
			protected function button1_clickHandler(event:MouseEvent):void
			{
				lobbychatbox.selectAll();
				lobbychatbox.insertText("");
			}
			
			protected function group1_creationCompleteHandler(event:FlexEvent):void
			{
				// 当窗口创建完�E皁E���
				// 创建对话用皁E���E系统，并封E��E��绑定到主显示窗口�
				Messenger.Instance;	// net part
				ui1.addChild(inputboxLobby.createInputbox(14, 438, 231, 18, 0));	// view part  
				this.addElement(ui1);
				ui1.visible = false;
			}

			protected function state3_enterStateHandler(event:FlexEvent):void
			{
				Messenger.Instance.stopGame();
				Messenger.Instance.startLobby();
				emotion.setType(0);
				ui1.visible = true;
			}
			
			protected function state2_enterStateHandler(event:FlexEvent):void
			{
				if(emotion)
				{
					emotion.visible = false;
				}
				ui1.visible = false;
			}
			
			protected function btnEmotion_clickHandler(event:MouseEvent):void
			{
				emotion.visible = !emotion.visible;
			}
			

			protected function lobbySendMsg(event:MouseEvent):void
			{
				inputEditManager(inputboxLobby.textinput.interactionManager).sendButtonPressed();
			}


			protected function colorpicker1_changeHandler(event:ColorPickerEvent):void
			{
				inputboxLobby.changeInputColor(event.color);
			}


			protected function fontsizeStepper_changeHandler(event:Event):void
			{
				inputboxLobby.fontsize = fontsizeStepper.value;
			}

			// 发送喊话按钮
			protected function shoutbtn_clickHandler(event:MouseEvent):void
			{
				if(!LobyManager.Instance.windowMutex){
					FlexGlobals.topLevelApplication.shoutmsgbox.visible = true;
					LobyManager.Instance.windowMutex = true;
				}
			}


			protected function lobbychatbox_creationCompleteHandler(event:FlexEvent):void
			{
				lobbychatbox.textFlow = new TextFlow();
			}


		]]>
	</fx:Script>
</s:Group>