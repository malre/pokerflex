<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" currentState="MainMenu"
	creationComplete="creationComplete()" enterFrame="enterFrame(event)"
	click="click(event)" mouseDown="mouseDown(event)" mouseUp="mouseUp(event)" mouseMove="mouseMove(event)">
<!-- 添加状态控制部分 -->
	<mx:states>
		<mx:State 
			name="Game"			
			enterState="enterGame(event)"
        	exitState="exitGame(event)">
			<mx:AddChild relativeTo="{myCanvas}" position="lastChild">
				<mx:Button x="327.5" y="416.25" label="出牌" width="65" height="22.045454" id="btnSendCards"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{myCanvas}" position="lastChild">
				<mx:Button x="400.5" y="416.25" label="放弃" width="65" height="22.045454" id="btnDiscard"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{myCanvas}" position="lastChild">
				<mx:Button x="491.75" y="416.25" label="提示" width="65" height="22.045454" id="btnHint"/>
			</mx:AddChild>
			<mx:SetStyle target="{myCanvas}" name="backgroundAlpha" value="1.0"/>
			<mx:SetProperty target="{myCanvas}" name="width" value="800"/>
			<mx:SetProperty target="{myCanvas}" name="height" value="600"/>
			<mx:SetStyle target="{myCanvas}" name="borderStyle" value="inset"/>
			<mx:SetStyle target="{myCanvas}" name="borderColor" value="#B7BABC"/>
			<mx:SetProperty target="{myCanvas}" name="x"/>
			<mx:SetStyle target="{myCanvas}" name="horizontalCenter" value="0"/>
			<mx:SetProperty target="{myCanvas}" name="y"/>
			<mx:SetStyle target="{myCanvas}" name="verticalCenter" value="0"/>
			<mx:SetStyle name="cornerRadius" value="0"/>
			<mx:AddChild relativeTo="{myCanvas}" position="lastChild">
				<mx:Button x="272.9" y="327.55" label="准备好了" width="93.71212" height="81.06061" id="btnReady" click="gameReadyClicked(event)"/>
			</mx:AddChild>
		</mx:State>
		<mx:State 
			name="LevelEnd">
			<mx:AddChild relativeTo="{myCanvas}" position="lastChild">
				<mx:Button x="514" y="368" label="Continue" id="btnContinue" click="btnContinueClicked(event)"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{myCanvas}" position="lastChild">
				<mx:Label x="10" y="10" text="Congratulations, you finished the level."/>
			</mx:AddChild>
			<mx:SetProperty target="{myCanvas}" name="x"/>
			<mx:SetStyle target="{myCanvas}" name="horizontalCenter" value="0"/>
			<mx:SetProperty target="{myCanvas}" name="y"/>
			<mx:SetStyle target="{myCanvas}" name="verticalCenter" value="0"/>
		</mx:State>
		<mx:State name="MainMenu">
			<mx:AddChild relativeTo="{myCanvas}" position="lastChild">
				<mx:Image x="371.5" y="171" source="@Embed('../res/suit_big.png')"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{myCanvas}" position="lastChild">
				<mx:Label x="374.5" y="120" text="双扣" fontSize="20" fontWeight="bold"/>
			</mx:AddChild>
			<mx:SetProperty target="{myCanvas}" name="width" value="800"/>
			<mx:SetProperty target="{myCanvas}" name="height" value="600"/>
			<mx:SetProperty target="{myCanvas}" name="x"/>
			<mx:SetStyle target="{myCanvas}" name="horizontalCenter" value="0"/>
			<mx:SetProperty target="{myCanvas}" name="y"/>
			<mx:SetStyle target="{myCanvas}" name="verticalCenter" value="0"/>
			<mx:SetStyle target="{myCanvas}" name="borderStyle" value="inset"/>
			<mx:SetStyle target="{myCanvas}" name="borderColor" value="#B7BABC"/>
			<mx:SetStyle target="{myCanvas}" name="themeColor" value="#009DFF"/>
			<mx:SetStyle target="{myCanvas}" name="backgroundAlpha" value="1.0"/>
			<mx:AddChild relativeTo="{myCanvas}" position="lastChild">
				<mx:TextArea x="279" y="385.85" width="238" height="89" id="loginlog" editable="false"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{myCanvas}" position="lastChild">
				<mx:Button x="623" y="413.85" label="加入默认房间" id="btnJoin" click="startGameClicked(event)"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{myCanvas}" position="lastChild">
				<mx:Button x="623" y="494" label="Debug" id="btnDebug" click="startDebugClicked(event)"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{myCanvas}" position="lastChild">
				<mx:Button x="623" y="452.85" label="退出默认房间" id="btnLeave" click="leaveGameClicked(event)"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="WaitReady">
		</mx:State>
	</mx:states>
	<!--定义画布-->
	<mx:Canvas x="0" y="0" width="100%" height="100%" id="myCanvas"/>
	<!--定义http连接-->
    <mx:HTTPService useProxy="false" id="httpService" method="POST" showBusyCursor="true"
    	url=""
    	result="{NetManager.Instance.resultProcess(event)}" fault="{NetManager.Instance.failProcess(event)}">
        <mx:request>
            <data>"{NetManager.getSendData()}"</data>
        </mx:request>
    </mx:HTTPService>
	
	<mx:Script>
		<![CDATA[
			protected var inGame:Boolean = false;

			private function enterGame(event:Event):void
			{
//				Mouse.hide();
				//Game.Instance.init();
				inGame = true;
			}
			
			private function exitGame(event:Event):void
			{
//				Mouse.show();
				GameObjectManager.Instance.shutdown();
				inGame = false;
			}
			
			private function startGameClicked(event:Event):void
			{
				//currentState="WaitReady";
				NetManager.Instance.send(NetManager.send_joinRoom);
			}
			
			private function leaveGameClicked(event:Event):void
			{
				//currentState="WaitReady";
				NetManager.Instance.send(NetManager.send_leave);
			}

			private function startDebugClicked(event:Event):void
			{
				currentState="Game";
				Game.Instance.init();
				Game.Instance.gameState = 2;
			}

			private function gameReadyClicked(event:Event):void
			{
				//currentState="Game";
				NetManager.Instance.send(NetManager.send_waitForReady);
			}
			
			private function btnContinueClicked(event:Event):void
			{
			}

			public function creationComplete():void
			{
			
			}
			
			public function enterFrame(event:Event):void
			{
	    		// 逻辑部分的循环
	    		Game.Instance.taskLoop(currentState);
		    	if (inGame)
		    	{
		    		// 描画部分的循环
		    		myCanvas.graphics.clear();
		    		myCanvas.graphics.beginBitmapFill(GameObjectManager.Instance.backBuffer, null, false, false);
		    		myCanvas.graphics.drawRect(0, 0, this.width, this.height);
		    		myCanvas.graphics.endFill();
		    	}	
			}
			
			public function click(event:MouseEvent):void
			{
				
			}
			
			public function mouseDown(even:MouseEvent):void
			{
			
			}
			
			public function mouseUp(event:MouseEvent):void
			{
			
			}
			
			public function mouseMove(event:MouseEvent):void
			{
				
			}
		]]>
	</mx:Script>
</mx:Application>
